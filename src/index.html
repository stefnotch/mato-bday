<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- TODO:
Mato likes: Terraria, Cats, Kebap, Mato Cola, 420
Randomly replace Mato with Mango

    - shadows
    - fancy borders https://www.google.com/search?q=css+golden+frame&client=firefox-b-m&tbm=isch&prmd=ivsn&ved=2ahUKEwj394-jsrSAAxW-jZUCHSg3BlIQ_AUoAXoECAQQAQ&dpr=2.61#imgrc=3zxP4VMgPW__kM
    https://codepen.io/yuhomyan/pen/jOqvjZq
    https://codepen.io/chilliconcode/pen/OWxqYR
    - From: Names from people
    - SVG fonts

    - https://forums.terraria.org/index.php?threads/to-terraria-with-love-contest-entry-thread.105250/page-2
    -->
  </head>
  <body>
    <script type="module">
      import { ConfettiDrawer } from "./src/confetti.js";
      const degToRad = (deg) => (deg * Math.PI) / 180;

      const happyBirthdayMessage = document.querySelector(
        ".happy-birthday-message"
      );
      const happyBirthdayMessageSubtitle = document.querySelector(
        ".happy-birthday-message-subtitle"
      );
      let cardOpenTime = null;
      const canvas = document.querySelector("#canvas");
      const ctx = canvas.getContext("2d");
      const confettiDrawer = new ConfettiDrawer(ctx);

      function render() {
        let isCardOpen = cardAngle < 70;
        if (isCardOpen) {
          if (cardOpenTime === null) {
            cardOpenTime = Date.now();
            happyBirthdayMessage.style.transition =
              "opacity 0.5s ease-in-out, transform 0.7s 2.0s ease-in-out";
            happyBirthdayMessage.style.opacity = "1";
            happyBirthdayMessage.style.transform =
              "translateY(calc(var(--card-width) * -0.5))";
            happyBirthdayMessageSubtitle.textContent = "ToMato!";
            confettiDrawer.addConfetti(
              ctx,
              canvas.width * 0.5,
              canvas.height / 2,
              8,
              degToRad(90 + 45),
              degToRad(45),
              100
            );
            confettiDrawer.addConfetti(
              ctx,
              canvas.width * 0.5,
              canvas.height / 2,
              8,
              degToRad(90 - 45),
              degToRad(45),
              100
            );
          } else if (Date.now() - cardOpenTime > 2100) {
            let deltaSeconds = (Date.now() - cardOpenTime - 2100) / 1000;
            let animationFrames = [
              "ToMato!",
              "To Mato!",
              "To  Mato!",
              "To o Mato!",
              "To ot Mato!",
              "To out Mato!",
              "To oust Mato!",
              "To ourst Mato!",
              "To ourest Mato!",
              "To our est Mato!",
              "To our rest Mato!",
              "To our drest Mato!",
              "To our darest Mato!",
              "To our dearest Mato!",
            ];
            happyBirthdayMessageSubtitle.textContent =
              animationFrames[
                Math.max(
                  0,
                  Math.min(
                    animationFrames.length - 1,
                    Math.floor(deltaSeconds * 2.5 * animationFrames.length)
                  )
                )
              ];
          }
        } else {
          cardOpenTime = null;
          happyBirthdayMessage.style.transition = "";
          happyBirthdayMessage.style.opacity = "0";
          happyBirthdayMessage.style.transform = "translateY(0)";
        }
      }
    </script>
  </body>
</html>
